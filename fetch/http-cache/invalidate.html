<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>HTTP Cache - Invalidation</title>
    <meta name="help" href="https://fetch.spec.whatwg.org/#request">
    <script src="/resources/testharness.js"></script>
    <script src="/resources/testharnessreport.js"></script>
    <script src="/common/utils.js"></script>
    <script src="/common/get-host-info.sub.js"></script>
    <script src="http-cache.js"></script>
  </head>
  <body>
    <script>
    var tests = [
      {
        name: 'HTTP cache invalidates after a successful response from a POST',
        requests: [
          {
            template: "fresh"
          }, {
            request_method: "POST",
            request_body: "abc",
          }, {
            expected_type: "not_cached"
          } 
        ]
      },
      {
        name: 'HTTP cache does not invalidate after a failed response from an unsafe request',
        requests: [
          {
            template: "fresh"
          }, {
            request_method: "POST",
            request_body: "abc",
            response_status: [500, "Internal Server Error"]
          }, {
            expected_type: "cached"
          } 
        ]
      },
      {
        name: 'HTTP cache invalidates after a successful response from a PUT',
        requests: [
          {
            template: "fresh"
          }, {
            template: "fresh",
            request_method: "PUT",
            request_body: "abc",
          }, {
            expected_type: "not_cached"
          } 
        ]
      },
      {
        name: 'HTTP cache invalidates after a successful response from a DELETE',
        requests: [
          {
            template: "fresh"
          }, {
            request_method: "DELETE",
            request_body: "abc",
          }, {
            expected_type: "not_cached"
          } 
        ]
      },
      {
        name: 'HTTP cache invalidates after a successful response from an unknown method',
        requests: [
          {
            template: "fresh"
          }, {
            request_method: "FOO",
            request_body: "abc",
          }, {
            expected_type: "not_cached"
          } 
        ]
      }
    ];
    run_tests(tests);
    </script>
  </body>
</html>
